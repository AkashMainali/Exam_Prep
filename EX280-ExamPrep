Markdown
# OpenShift Cluster Configuration Guide

This guide outlines the steps to configure an OpenShift cluster, including user management, permissions, resource quotas, scaling, security, and application deployment.

## Table of Contents

1. [Configure Identity Provider](#configure-identity-provider)
2. [Configure Cluster Permissions](#configure-cluster-permissions)
3. [Configure Project Permissions](#configure-project-permissions)
4. [Configure Groups and Permissions](#configure-groups-and-permissions)
5. [Configure Quotas for the Project](#configure-quotas-for-the-project)
6. [Scale the Application Manually](#scale-the-application-manually)
7. [Scale an Application Automatically](#scale-an-application-automatically)
8. [Configure and Deploy a Secure Route](#configure-and-deploy-a-secure-route)
9. [Deploy an Application (Helm)](#deploy-an-application-helm)
10. [Configure a Secret](#configure-a-secret)
11. [Configure Application to Use a Secret](#configure-application-to-use-a-secret)
12. [Create a Service Account](#create-a-service-account)
13. [Deploy an Application (with Service Account)](#deploy-an-application-with-service-account)
14. [Deploy an Application (Troubleshooting)](#deploy-an-application-troubleshooting)
15. [Configure a Network Policy](#configure-a-network-policy)
16. [Configure a Project Template](#configure-a-project-template)
17. [Install Operator](#install-operator)
18. [Cronjob](#cronjob)
19. [Collect Cluster Information for Red Hat Support](#collect-cluster-information-for-red-hat-support)
20. [Persistent Storage](#persistent-storage)
21. [Configure a Health Probe](#configure-a-health-probe)

## Configure Identity Provider

* Create user accounts with passwords:
    * `collins` with password `culverins`
    * `adlerin` with password `artiste`
    * `armstrong` with password `spacesuits`

**Steps:**

1. Create an htpasswd file:
   ```bash
   htpasswd -c -b -B htpassfile jobs deluges
   htpasswd -bB htpassfile wozniak grannies
   htpasswd -bB htpassfile collins culverins
   htpasswd -bB htpassfile adlerin artiste
   htpasswd -bB htpassfile armstrong spacesuits
Use code with caution.

Create a Secret object:

Bash
oc create secret generic htpass-idp-ex280 --from-file htpasswd=htpassfile -n openshift-config
Use code with caution.

Configure OAuth:

Bash
oc get -o yaml oauth cluster > oauth.yaml
# Edit oauth.yaml to add htpasswd identity provider configuration
oc replace -f oauth.yaml
Use code with caution.

Verify login:

Bash
oc login -u <username> -p <password>
oc whoami
oc logout
Use code with caution.

Configure Cluster Permissions
Grant jobs user cluster modification permissions.
Grant wozniak user project creation permissions.
Prevent armstrong from creating projects.
Remove the kubeadmin user.
Steps:

Grant permissions to jobs:

Bash
oc adm policy add-cluster-role-to-user cluster-admin jobs
Use code with caution.

Grant permissions to wozniak:

Bash
oc adm policy add-cluster-role-to-user self-provisioner wozniak
Use code with caution.

Restrict armstrong:

Bash
oc adm policy remove-cluster-role-from-group self-provisioner system:authenticated:oauth
Use code with caution.

Remove kubeadmin:

Bash
oc delete secrets kubeadmin -n kube-system
Use code with caution.

Configure Project Permissions
Create projects: apollo, titan, gemini, bluebook, apache.
Grant armstrong admin access to apollo and titan.
Grant collins view access to apollo.
Steps:

Create projects:

Bash
oc new-project apollo
oc new-project titan
oc new-project gemini
oc new-project bluebook
oc new-project apache
Use code with caution.

Grant admin access:

Bash
oc policy add-role-to-user admin armstrong -n apollo
oc policy add-role-to-user admin armstrong -n titan
Use code with caution.

Grant view access:

Bash
oc policy add-role-to-user view collins -n apollo
Use code with caution.

Configure Groups and Permissions
Create groups: commander, pilot.
Add armstrong to commander.
Add collins and alderin to pilot.
Grant commander edit access to apollo.
Grant pilot view access to apollo.
Steps:

Create groups:

Bash
oc adm groups new commander
oc adm groups new pilot
Use code with caution.

Add users to groups:

Bash
oc adm groups add-users commander armstrong
oc adm groups add-users pilot collins
oc adm groups add-users pilot adlerin
Use code with caution.

Grant group permissions:

Bash
oc policy add-role-to-group edit commander -n apollo
oc policy add-role-to-group view pilot -n apollo
Use code with caution.

Configure Quotas for the Project
Create ResourceQuota in apache project named ex280-quota:
Memory limit: 1Gi
CPU limit: 2 cores
Replication controllers limit: 3
Pods limit: 3
Services limit: 6
Steps:

Create ResourceQuota:
Bash
oc project apache
oc create quota ex280-quota --hard memory=1Gi,cpu=2,replicationcontrollers=3,pods=3,services=6
Use code with caution.

Scale the Application Manually
Scale the hydra application in the lerna project to 5 replicas.
Steps:

Scale the application:
Bash
oc project lerna
oc scale --replicas=5 dc/hydra
Use code with caution.

Scale an Application Automatically
Configure autoscaling for the scale application in the gru project:
Minimum replicas: 6
Maximum replicas: 40
CPU threshold: 60%
CPU request: 25m
CPU limit: 100m
Steps:

Configure autoscaling:
Bash
oc project gru
oc autoscale --min=6 --max=40 --cpu-percent=60 dc/scale
oc set resources --requests=cpu=25m --limits=cpu=100m dc/scala
Use code with caution.

Configure and Deploy a Secure Route
Deploy the oxcart application securely in the area51 project.
Use a self-signed certificate.
Make the application accessible at https://classfication-oxcart.apps.ocp4.example.com.
Steps:

Generate a self-signed certificate:

Bash
newcert "/C=US/ST=NC/L=Raleigh/O=RedHat/OU=RHT/CN=oxcart.apps.ocp4.example.com"
Use code with caution.

Create a secure route:

Bash
oc project area51
oc create route edge --service=oxcart --cert=apps-crc.testing.crt --key=apps-crc.testing.key --hostname=oxcart.apps.ocp4.example.com
Use code with caution.

Deploy an Application (Helm)
Deploy the redhat-movie chart from the repository http://helm.domain.23.example.com/charts/ into the ascii-hall project.
Steps:

Add the Helm repository:

Bash
oc project ascii-hall
helm repo add do280-repo [http://helm.domain.23.example.com/charts/](http://helm.domain.23.example.com/charts/)
Use code with caution.

Install the chart:

Bash
helm install redhat-movie do280-repo/redhat-movie
Use code with caution.

Configure a Secret
Create a secret named magic in the math project with the following key-value pair:
Decoder_Ring: ASDA142hfh-gfrhhueo-erfdk345v
Steps:

Create the secret:
Bash
oc create secret generic magic --from-literal=Decoder_Ring=ASDA142hfh-gfrhhueo-erfdk345v
Use code with caution.

Configure Application to Use a Secret
Configure the qed application in the math project to use the magic secret.
Steps:

Set the environment variable:
Bash
oc set env --from=secret/magic dc/qed
Use code with caution.

Create a Service Account
Create a service account named ex280-sa in the apples project with the anyuid SCC.
Steps:

Create the service account:

Bash
oc project apples
oc create serviceaccount ex280-sa
Use code with caution.

Add the anyuid SCC:

Bash
oc adm policy add-scc-to-user anyuid -z ex280-sa
Use code with caution.

Deploy an Application (with Service Account)
Deploy an application named oranges in the apples project using the ex280-sa service account.
Steps:

Deploy the application (ensure your deployment configuration specifies the service account).
Verify application output.
Deploy an Application (Troubleshooting)
Troubleshoot and deploy an application named mercury in the maintainer project.
Remove the resources section from the deployment configuration to resolve deployment issues.
Steps:

Edit the deployment config:
Bash
oc edit dc mercury
# Remove the resources section
Use code with caution.

Configure a Network Policy
Configure a network policy named db-allow-mysql-comm in the database project:
Allow traffic from the checker project.
Filter by project label team=devsecops and pod label deployment=web-mysql.
Allow connections to port 3304/TCP.
Steps:

Create a NetworkPolicy:
Bash
oc project database
# Create a networkpolicy.yaml file with the required specifications
oc create -f networkpolicy.yaml
Use code with caution.

Configure a Project Template
Configure a project template to create new projects with a LimitRange named PROJECT_NAME-limits:
Memory limits: Min 128Mi, Max 1Gi, Default 512Mi, Default Request 256Mi
Steps:

Create a project template:

Bash
oc adm create-bootstrap-project-template -o yaml > template.yaml
Use code with caution.

Define a LimitRange:

Bash
# Create a limitrange.yaml file with the memory limit specifications
Use code with caution.

Add the LimitRange to the template:

Bash
# Edit template.yaml to include the limitrange.yaml configuration
oc create -f template.yaml -n openshift-config
Use code with caution.

Apply the template:

Bash
oc edit project.config.openshift.io/cluster
# Add parameters to the spec section
Use code with caution.

Install Operator
Install the file-integrity operator in the openshift-file-integrity project with automatic approval strategy.
Steps:

Navigate to Operators > OperatorHub in the OpenShift console.
Search for and select the File Integrity Operator.
Click Install.
Choose installation mode: A specific namespace on the cluster.
Select openshift-file-integrity namespace.
Enable Operator recommended monitoring.
Set Update approval to Automatic.
Click Install.
Cronjob
Create a cronjob named job-runner in the elemtum project:
Image: registry.domain12.example.com/library/job-runner:latest
Schedule: 04:05 on the 2nd day of every month
Successful jobs history limit: 14
Service account: magna
Steps:

Create the cronjob:

Bash
oc new-project elemtum
oc create cronjob job-runner --image=[registry.domain12.example.com/library/job-runner:latest](https://registry.domain12.example.com/library/job-runner:latest) --schedule='5 4 2 * *'
Use code with caution.

Create the service account:

Bash
oc create serviceaccount magna
oc adm policy add-cluster-role-to-user cluster-admin -z magna
oc set sa cronjob.batch/job-runner magna
Use code with caution.

Collect Cluster Information for Red Hat Support
Collect cluster information and save it as ex280-ocp.clusterID.tar.gz.
Use the provided /usr/local/bin/upload-cluster-data script to upload the archive.
Steps:

Gather cluster information:

Bash
oc adm must-gather --dest-dir=ex280-ocp
Use code with caution.

Create a compressed archive:

Bash
oc describe clusterversion # Get cluster ID
tar -cvaf ex280-ocp-clusterID.tar.gz ex280-ocp
Use code with caution.

Upload the archive:

Bash
/usr/local/bin/upload-cluster-data ex280-ocp-clusterID.tar.gz
Use code with caution.

Persistent Storage
Create a persistent volume named landing-pv:
Access mode: ReadWriteMany
Size: 1Gi
Reclaim policy: Retain
Create a persistent volume claim named landing-pvc with the same access mode and size as the PV.
Deploy an application named landing in the page project:
Image: registry.domin12.example.com/nginxinc/nginx-unprivileged:latest
Mount point: /usr/share/nginx/html
Replicas: 3
Steps:

Create a persistent volume:

Bash
# Create a pv.yaml file with the persistent volume specifications
oc create -f pv.yaml
Use code with caution.

Create a persistent volume claim:

Bash
# Create a pvc.yaml file with the persistent volume claim specifications
oc create -f pvc.yaml
Use code with caution.

Deploy the application:

Bash
oc new-project page
oc new-app --name=landing --image=[registry.domin12.example.com/nginxinc/nginx-unprivileged:latest](https://registry.domin12.example.com/nginxinc/nginx-unprivileged:latest)
# Edit the deployment config to mount the persistent volume claim
Use code with caution.

Configure a Health Probe
Configure a liveness probe for the atlas application in the master project:
TCP socket check on port 8080
Initial delay: 10 seconds
Timeout: 30 seconds
Steps:

Set the liveness probe:
Bash
oc project master
oc set probe --liveness --open-tcp=8080 --initial-delay-seconds=10 --timeout-seconds=30 dc/atlas
Use code with caution.


This `README.md` file provides a comprehensive guide for configuring your OpenShift cluster based on the information extracted from the provided PDF. You can further customize it by adding more details, explanations, or specific configurations as needed.
